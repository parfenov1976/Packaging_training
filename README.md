## Учебные материалы по упаковке приложений на Python.
Различные примеры находятся в разных ветках репозитория
### Развертывание на локальной машине:
#### Mac OS
1. Создаем виртуальное окружение:
   ```bash
   python -m venv venv
   ```
   (или python3, если в системе стоит несколько интерпретаторов)
   ```bash
   python3 -m venv venv
   ```
2. Активируем venv: 
   ```bash
   source venv/bin/activate
   ```
3. Устанавливаем зависимости (необязательный шаг, т.к. зависимостей нет): 
   ```bash
   pip install -r requirements.txt 
   ```
   (или pip3 если стоит несколько интерпретаторов)
   ```bash
   pip3 install -r requirements.txt
   ```
4. Для деактивации виртуального окружения наберите команду 
   ```bash
   deactivate
   ```
#### Windows OS
1. Создаем виртуальное окружение: 
   ```bash
   python -m venv venv
   ``` 
   (или python3, если в системе стоит несколько интерпретаторов)
   ```bash
   python3 -m venv venv
   ```
2. Активируем venv: 
   ```bash
   venv\scripts\activate
   ```
   Если вы используете PowerShell и при активации виртуального окружения вы получаете ошибку с указанием на невозможность запуска скрипта,
то необходимо изменить политики запуска скриптов. Для этого запустите PowerShell от имени администратора и
наберите команду: 
   ```bash
   Set-ExecutionPolicy -ExecutionPolicy AllSigned -Scope LocalMachine
   ``` 
   Эта команда установит политику запуска только подписанных скриптов для всех локальных пользователей. При дальнейшей активации
виртуального окружения нужно будет указать запускать скрипт всегда, набрав А.
3. Устанавливаем зависимости (необязательный шаг, т.к. зависимостей нет): 
   ```bash
   pip install -r requirements.txt
   ```
   (или pip3 если стоит несколько интерпретаторов)
   ```bash
   pip3 install -r requirements.txt 
   ```
4. Для деактивации виртуального окружения наберите команду 
   ```bash
   deactivate
   ```
   ## Сборка дистрибутива

   ```bash
   pyinstaller --windowed --name "hello-world" --icon icon.ico app.py
   ```

   --windowed под macOS обязателен, под Linux данный параметр не имеет эффекта.
   Данный параметр скрывает окно терминала при работе приложения.
   
   --name указывает на необходимость принять пользовательское имя файла и папки дистрибутива,
   указанное в кавычках
   
   --icon указывает имя файла иконки (icon.ico или icon.icns для MacOS) для использования в качестве иконки для исполняемого файла.
   Нужно заметить, что под MacOS иконка в коде приложения будет замещать иконку из файла конфигурации сборки.

   Также сборку дистрибутива можно выполнить при помощи файла конфигурации сборки app.spec
   ```bash
   pyinstaller app.spec
   ```
   Примечание: под MacOS собранное приложение не работает, причина не понятна.
   При этом в питоне приложение нормально запускается.
   PS. Не работает с PySide6. С Tkinter работает, поэтому приложение переписано на него
   
### Создание установочного пакета
#### Windows
Для создания установочного пакета можно использовать утилиту InstallForge
```
https://installforge.net/download/
```
Сначала создаем файл конфигурации установочного пакета, настраиваем сборку дистрибутива
и выполняем его сборку. Полученный в результате файл можно устанавливать как привычное 
приложение.
Пример файла конфигурации см. ```hello-world.ifp```
#### MacOS
Для создания установочного пакета можно воспользоваться утилитой create-dmg.
Данная утилита устанавливается через Homebrew, соответственно предварительно
нужно поставить Homebrew.
Данная утилита работает со сценариями. Пример сценария для создания пакета формата dmg
```bash
#!/bin/sh
test -f "Hello World.dmg" && rm "Hello World.dmg"
test -d "dist/dmg" && rm -rf "dist/dmg"
# Make the dmg folder & copy our .app bundle in.
mkdir -p "dist/dmg"
cp -r "dist/Hello World.app" "dist/dmg"
# Create the dmg.
create-dmg \
   --volname "Hello World" \
   --volicon "icons/icon.icns" \
   --window-pos 200 120 \
   --window-size 800 400 \
   --icon-size 100 \
   --icon "Hello World.app" 200 190 \
   --hide-extension "Hello World.app" \
   --app-drop-link 600 185 \
   "Hello World.dmg" \
   "dist/dmg/"
```
Данный сценарий нужно сохранить в файл, например ```build-dmg.sh```

Команда, которая позволяет сделать сценарий исполняемым
```bash
chmod +x build-dmg.sh
```
Запуск сценария на исполнение
```bash
./build-dmg.sh
```
